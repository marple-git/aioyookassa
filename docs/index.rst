..

aioyookassa Documentation
=========================

**–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API YooKassa**

`aioyookassa` ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º YooKassa. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤—Å–µ—Ö API –¥–æ–º–µ–Ω–æ–≤ YooKassa, –≤–∫–ª—é—á–∞—è –ø–ª–∞—Ç–µ–∂–∏, –≤–æ–∑–≤—Ä–∞—Ç—ã, —á–µ–∫–∏, —Å—á–µ—Ç–∞, –≤—ã–ø–ª–∞—Ç—ã, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–¥–µ–ª–∫–∏, webhooks –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.

.. image:: https://pepy.tech/badge/aioyookassa
   :target: https://pepy.tech/project/aioyookassa
   :alt: Downloads

.. image:: https://pepy.tech/badge/aioyookassa/month
   :target: https://pepy.tech/project/aioyookassa
   :alt: Downloads per month

.. image:: https://api.codiga.io/project/34833/score/svg
   :target: https://api.codiga.io/project/34833/score/svg
   :alt: Code Quality Score

.. image:: https://api.codiga.io/project/34833/status/svg
   :target: https://api.codiga.io/project/34833/status/svg
   :alt: Code Grade

‚ú® **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
------------------

* üöÄ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** ‚Äî –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `asyncio` –¥–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
* üõ°Ô∏è **–¢–∏–ø–∏–∑–∞—Ü–∏—è** ‚Äî –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Pydantic –º–æ–¥–µ–ª–µ–π
* üîß **–ü—Ä–æ—Å—Ç–æ—Ç–∞** ‚Äî –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–π API –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
* üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
* üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî 95% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ —Ç–µ—Å—Ç–∞–º–∏
* ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å HTTP –∑–∞–ø—Ä–æ—Å–∞–º–∏
* üéØ **–ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ API** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ –¥–æ–º–µ–Ω—ã YooKassa API

üöÄ **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç**
-------------------

–£—Å—Ç–∞–Ω–æ–≤–∫–∞
~~~~~~~~~

.. code-block:: bash

    pip install aioyookassa>=2.0.0

–ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
~~~~~~~~~~~~~~~~~~~~~

.. note::

   –í –≤–µ—Ä—Å–∏–∏ 2.1.0 `PaymentAmount` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `Money` –¥–ª—è –ª—É—á—à–µ–π —Å–µ–º–∞–Ω—Ç–∏–∫–∏.
   `PaymentAmount` –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ alias –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

.. code-block:: python

    import asyncio
    from datetime import datetime
    from aioyookassa import YooKassa
    from aioyookassa.types.payment import Money, Confirmation
    from aioyookassa.types.enum import PaymentStatus, ConfirmationType, Currency
    from aioyookassa.types.params import CreatePaymentParams, GetPaymentsParams

    async def main():
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
        client = YooKassa(api_key="your_api_key", shop_id=12345)

        # –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º Pydantic –º–æ–¥–µ–ª—å)
        params = CreatePaymentParams(
            amount=Money(value=100.00, currency=Currency.RUB),
            confirmation=Confirmation(type=ConfirmationType.REDIRECT, return_url="https://example.com/return"),
            description="–¢–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂"
        )
        payment = await client.payments.create_payment(params)

        print(f"Payment created: {payment.id}")
        print(f"Confirmation URL: {payment.confirmation.url}")

        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–ª–∞—Ç–µ–∂–µ
        payment_info = await client.payments.get_payment(payment.id)
        print(f"Payment status: {payment_info.status}")

        # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ —Å–µ–≥–æ–¥–Ω—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º Pydantic –º–æ–¥–µ–ª—å)
        today = datetime.now()
        params = GetPaymentsParams(
            created_at=today,
            status=PaymentStatus.SUCCEEDED
        )
        payments = await client.payments.get_payments(params)
        print(f"Found {len(payments.list)} successful payments today")

        # –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
        await client.close()

    # –ó–∞–ø—É—Å–∫
    asyncio.run(main())

üéØ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ API –¥–æ–º–µ–Ω—ã**
---------------------------------

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–≤—Å–µ API –¥–æ–º–µ–Ω—ã YooKassa**:

* üí≥ **–ü–ª–∞—Ç–µ–∂–∏ (Payments)** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –æ—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–µ–π
* üí∞ **–í–æ–∑–≤—Ä–∞—Ç—ã (Refunds)** ‚Äî –ø–æ–ª–Ω—ã–µ –∏ —á–∞—Å—Ç–∏—á–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—Ç—ã
* üßæ **–ß–µ–∫–∏ (Receipts)** ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ñ–∏—Å–∫–∞–ª—å–Ω—ã—Ö —á–µ–∫–æ–≤
* üìÑ **–°—á–µ—Ç–∞ (Invoices)** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏
* üí≥ **–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã (Payment Methods)** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ –æ–ø–ª–∞—Ç—ã
* üí∏ **–í—ã–ø–ª–∞—Ç—ã (Payouts)** ‚Äî –≤—ã–ø–ª–∞—Ç—ã –Ω–∞ –∫–∞—Ä—Ç—ã, —á–µ—Ä–µ–∑ –°–ë–ü, –Ω–∞ –∫–æ—à–µ–ª—å–∫–∏ –ÆMoney
* üë§ **–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–µ (Self-Employed)** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã–º–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º–∏
* üè¶ **–£—á–∞—Å—Ç–Ω–∏–∫–∏ –°–ë–ü (SBP Banks)** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –±–∞–Ω–∫–æ–≤ –°–ë–ü
* üîê **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Personal Data)** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
* ü§ù **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (Deals)** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ —Å–¥–µ–ª–∫–∞–º–∏
* üîî **Webhooks** ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö webhook-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–û–±—Ä–∞–±–æ—Ç–∫–∞ webhook-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö webhook-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

**–ì–æ—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä (–±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç):**

.. code-block:: python

    from aioyookassa.contrib.webhook_server import WebhookServer
    from aioyookassa.core.webhook_handler import WebhookHandler
    from aioyookassa.types.enum import WebhookEvent
    from aioyookassa.types.payment import Payment

    handler = WebhookHandler()

    @handler.register_callback(WebhookEvent.PAYMENT_SUCCEEDED)
    async def on_payment_succeeded(payment: Payment):
        print(f"‚úÖ –ü–ª–∞—Ç–µ–∂ {payment.id} —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω")
        # –í–∞—à–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

    server = WebhookServer(handler=handler)
    server.run(host="0.0.0.0", port=8080)

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º:**

.. code-block:: python

    from aiohttp import web
    from aioyookassa.core.webhook_handler import WebhookHandler
    from aioyookassa.types.enum import WebhookEvent
    from aioyookassa.types.payment import Payment

    handler = WebhookHandler()

    @handler.register_callback(WebhookEvent.PAYMENT_SUCCEEDED)
    async def on_payment_succeeded(payment: Payment):
        await process_payment(payment)

    async def webhook_endpoint(request):
        # –í–∞–ª–∏–¥–∞—Ü–∏—è IP (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
        if not handler.validator.is_allowed(request.remote):
            raise web.HTTPForbidden()

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        data = await request.json()
        notification = handler.parse_notification(data)
        await handler.handle_notification(notification)

        return web.Response(status=200)

    app = web.Application()
    app.router.add_post("/webhook", webhook_endpoint)
    web.run_app(app)

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –æ–±—Ä–∞–±–æ—Ç–∫–µ webhook-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ :doc:`api-reference/webhook-handler-api`.

üìñ **–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ**
----------------

.. toctree::
   :maxdepth: 2
   
   installation
   getting-started/index
   api-reference/index
   types/index
   examples/index
   changelog
   contributing

‚ö†Ô∏è **Breaking Changes –≤ –≤–µ—Ä—Å–∏–∏ 2.0.0**
---------------------------------------

**–í–µ—Ä—Å–∏—è 2.0.0 —Å–æ–¥–µ—Ä–∂–∏—Ç breaking changes:**

* **–£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ç–∏–ø—ã:**
  * `RefundCancellationDetails` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `CancellationDetails`
  * `RefundSettlement` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Settlement`
  * `ReceiptSettlement` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Settlement`

**–ú–∏–≥—Ä–∞—Ü–∏—è:**

.. code-block:: python

    # –î–æ –≤–µ—Ä—Å–∏–∏ 2.0.0
    from aioyookassa.types import RefundCancellationDetails, RefundSettlement, ReceiptSettlement

    # –í–µ—Ä—Å–∏—è 2.0.0+
    from aioyookassa.types import CancellationDetails, Settlement

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ :doc:`changelog`.

üîó **–°—Å—ã–ª–∫–∏**
-------------

* `GitHub Repository <https://github.com/masasibata/aioyookassa>`_
* `PyPI Package <https://pypi.org/project/aioyookassa/>`_
* `YooKassa API Documentation <https://yookassa.ru/developers/api>`_

üíù **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞**
-----------------------

–ï—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ–∫–∞–∑–∞–ª–∞—Å—å –ø–æ–ª–µ–∑–Ω–æ–π, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:

* `Tribute <https://t.me/tribute/app?startapp=dzqR>`_ ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —á–µ—Ä–µ–∑ Telegram
* `Telegram —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ <https://t.me/masaasibaata>`_ ‚Äî —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º

* :ref:`genindex`
* :ref:`modindex`
* :ref:`search`
